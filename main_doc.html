<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>reworking your workflow</title>
    <meta charset="utf-8" />
    <meta name="author" content="Christof Neumann" />
    <meta name="date" content="2021-11-18" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# reworking your workflow
## combining data analysis and reporting with dynamic documents
### Christof Neumann
### RTG Understanding Social Relationships
### 2021-11-18

---


&lt;style type="text/css"&gt;
.XC .remark-code * {
  background-color: antiquewhite!important;
}
.XC2 .remark-code, .XC2 .remark-code * {
  background-color: seashell!important;
  # text-shadow: 0 0 5px #333;
}
.content-box { 
    box-sizing: border-box;
    background-color: #e2e2e2;
}
.content-box-yellow {
  box-sizing: border-box;
  border-radius: 15px;
  margin: 0 0 15px;
  overflow: hidden;
  padding: 0px 20px 0px 20px;
  width: 100%;
}
.content-box-blue { background-color: #F0F8FF; }
.content-box-yellow { background-color: #fef5c4; }

&lt;/style&gt;





## content

- dynamic documents, huh?

--

- what is R markdown and why should we care?

--

- the dark side of a dynamic workflow

--

- let's get our hands dirty

--

- my assumptions:
  
  - you have used `R` before and use RStudio 
  
  - you want to produce pdfs (article, thesis, presentation) or html (presentation, websites, `shiny`)
  
--

- adjust your expectations:
  
  - we scratch on the surface
  
  - always keep in mind what you **need** (and not what you **can do**)

  - fine line between what I would consider a 'good' presentation and showcasing the capabilities of `R` markdown

---
class: inverse, center, middle

# dynamic documents

---


## dynamic (or living) documents

- continuous updates, revisions and edits (think Wikipedia)

--

- as opposed to static (dead) document (think printed lexicon)

--

- in scientific context:

  - preprints
  
  - during write-up

--

- can you do good and transparent science without it? YES.

???
framework for updates and changes may be implemented or not

revision and updates




---



## a truly dynamic document

- this example grabs the data directly from the survey website










&lt;img src="main_doc_files/figure-html/unnamed-chunk-22-1.png" width="90%" style="display: block; margin: auto;" /&gt;



---



## background

- to replicate

.content-box-yellow[
obtaining consistent results across studies aimed at answering the same scientific question, each of which has obtained its own data.]

--

- to reproduce 

.content-box-yellow[
obtaining consistent results using the same input data, computational steps, methods, and conditions of analysis]


.footnote[&lt;font size="-1"&gt;https://doi.org/10.17226/25303&lt;/font&gt;]

---

## reproducibility

.content-box-yellow[
If someone applies the same analysis to the same data, then the same result should recur.]

.footnote[&lt;font size="-1"&gt;https://doi.org/10.1146/annurev-psych-020821-114157&lt;/font&gt;]


- process failure:

  - no results obtainable
  
  - unavailability of data and code
  
  - incomplete information about the analysis, software or tools
  
- outcome failure:

  - different results
  
  - error in original study or in reproduction attempt

???
In principle, all reported evidence should be reproducible. If someone applies the same analysis to the same data, then the same result should recur. Reproducibility tests can fail for two reasons. A process reproducibility failure occurs when the original analysis cannot be repeated because of unavailability of the data, code, information about the analysis to recreate the code, or necessary software or tools. An outcome reproducibility failure occurs when the reanalysis obtains a different result than reported originally. This can occur because of an error in either the original or reproduction study.


---
class: inverse, center, middle
# what is R markdown and why should we care?

---



background-image: url(decoration_files/ecosystem.png)
background-position: center
background-size: contain
background-position: 100% 100%
background-size: 400px

## `R` markdown?

&lt;style type="text/css"&gt;
.pull-left65 {
  float: left;
  width: 70%;
}
.pull-right35 {
  float: right;
  width: 35%;
}
.pull-right ~ p {
  clear: both;
}
&lt;/style&gt;

- **markdown** is a programming language for converting plain text into formatted text

--

- **R markdown** builds on this and allows producing formatted output that builds on R code 

--

.pull-left65[
- by now, the `rmarkdown` universe allows production of

  - text documents (journal articles, theses, books) 

  - presentations

  - websites (via blogdown)

  - interactive applications/dashboards (via shiny) 

  - exotic things (epub, docx, pptx, package documentation)
]

---

## `R` markdown?

- all these have in common:

  - a shared logic and style for mixing written text and results from analyses 
  
  - full reproducibility (at least in theory)

  - being open source and having an active community

  - still a high degree of flexibility
  
  - a certain aesthetic (it just looks good, no?)


---

## `R` markdown!

- self-contained

- reproducible

- robust

- it's what the cool kids do these days (thanks, Roger)

- but there are downsides, too (we'll get to that)

---

## why again?

&lt;img src="decoration_files/reproducibility-cartoon.png" width="50%" style="display: block; margin: auto;" /&gt;

.footnote[&lt;font size="-1"&gt;I can't find the origin of this cartoon. If you know, please let me know.&lt;/font&gt;]





---
class: center, middle
# your most important collaborator is your future self!!! 

---



## when does it get complicated?

- it might very well...

--

- actually, it's likely to happen sooner rather than later

--

- long execution time (think bootstraps, models in `stan`)

  - sending workspaces to Roger
  
  - save workspace or not? it depends

--

- collaborators/supervisors/students won't/can't be bothered

--

- (in)dependence of RStudio

--

- environment [R version, package versions] at time of writing (when it works) versus time of production [which is the same as writing but also may be months or years later (reproducibility)]

--

- subtle differences (e.g. this presentation format doesn't support references and only very simple tables)




---
class: inverse, center, middle
# the nitty and the gritty


---


## markdown (markup language)

- allows **plain text** with **simple formatting** to be translated into other formats

- independent of `R`, RStudio and `\(\LaTeX\)`

- .md

--

````md
Heading
=======

Sub-heading
-----------

Paragraphs **are** separated 
by a blank line.
````

.footnote[&lt;font size="-1"&gt;https://www.markdownguide.org/&lt;/font&gt;]


---

## R markdown

- extension of markdown

- allows combining markdown ('text', 'narrative') and `R` ('code')

- still plain text

- independent of `\(\LaTeX~\)` and RStudio (although the latter provides lots of convenience)

- .Rmd

--

.XC[
````
We can combine markdown and `R` code.
Backticks are really important here.

```{r, fig.cap = "My results."}
plot(1:10)
```
````
]

.footnote[&lt;font size="-1"&gt;https://rmarkdown.rstudio.com/&lt;/font&gt;]


---

## `knitr` (and `rmarkdown`)

- are R packages

- `knitr` takes the code chunks, runs them and 'knits' them back into markdown

- requires R, but its results are independent of R (because they are markdown)

- `rmarkdown` and `knitr` also provide several convenience functions

.footnote[&lt;font size="-1"&gt;https://yihui.org/knitr/&lt;/font&gt;]

---

## Pandoc

- document converter

- transforms .md into .html/.tex

- can also do tons of other conversions (-&gt; MS Office, LibreOffice, ...)

- independent of `R` and RStudio


.footnote[&lt;font size="-1"&gt;https://pandoc.org/&lt;/font&gt;]

---

## `\(\LaTeX\)`

- builds .pdf files (article, thesis, presentation) from .tex files

- "a software system for document preparation"

- "separating presentation from content"

- independent of `R` and RStudio

.footnote[&lt;font size="-1"&gt;https://www.latex-project.org/&lt;/font&gt;]

---

## in a nutshell

&lt;img src="decoration_files/rmd_workflow.png" width="2072" /&gt;


.footnote[&lt;font size="-1"&gt;https://bookdown.org/yihui/rmarkdown-cookbook/&lt;/font&gt;]





---
class: inverse, center, middle
# getting to it


---



## prep

- create a new RStudio project

- create a new `R` markdown file

- memorize some keyboard shortcuts

  - cmd/ctrl + shift + k: build document
  
  - cmd/ctrl + option/alt + i: new R chunk

  - cmd/ctrl + shift + enter: run current chunk
  
  - cmd/ctrl + shift + 0: restart `R`

---


## `yaml` header

- contains meta data for the final document (author, title, date)

- determines output format (here: `html_document`)

  - possibly with options (table of contents, highlighting options)
  
  - if we get to it, we might also try `pdf_document`
  
- other options:
  
  - control RStudio's behavior
  
  - bibliography data, reference style
  
  - line numbering and line spacing

- we won't look into this much, and mostly rely on the default options RStudio provides


---

## `yaml` header

````md
---
title: "Untitled"
author: "Christof Neumann"
date: "9/29/2021"
output: 
  html_document:
    highlight: tango
editor_options: 
  chunk_output_type: console
---
````



---


## a simple paragraph

.XC[
````
# Introduction

A short paragraph that contains a summary of the article, for
example the background and some major results. And note that 
the header 'Introduction' was formatted as a header because 
we put a \# in front of it (which is visible only in the source 
code of the document).
````
]

# Introduction

A short paragraph that contains a summary of the article, for example
the background and some major results. And note that the header
'Introduction' was formatted as a header because we put a \# in front of
it (which is visible only in the source code of the document).

---

## simple formatting

.XC[
````
Text can be **bold** or in *italics*. 
But we can also use ~~strike through~~.
Underlining is trickier and requires html code.
````
]

Text can be **bold** or in *italics*. 
But we can also use ~~strike through~~.
Underlining is trickier and requires html code.

---


## a first code chunk

.XC[
````
This is just some text about how to generate random numbers in R:

```{r}
rnorm(3)
```
Easy, no?
````
]


This is just some text about how to generate random numbers in R:


```r
rnorm(3)
```

```
## [1] -0.61901958 -0.05424848 -0.04937414
```

Easy, no?


---


## more on code chunks

.XC[
````
```{r}
x &lt;- rnorm(1000)
hist(x)
```
````
]



```r
x &lt;- rnorm(1000)
hist(x)
```

![](main_doc_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;


---

## more on code chunks

- use chunk options

.XC[
````
```{r, out.width = "40%", fig.align = 'center'}
x &lt;- rnorm(1000)
hist(x)
```
````
]



```r
x &lt;- rnorm(1000)
hist(x)
```

&lt;img src="main_doc_files/figure-html/unnamed-chunk-28-1.png" width="40%" style="display: block; margin: auto;" /&gt;


---

## more on code chunks

- hide the actual code, and add a caption (which is desired in many situations)
.XC[
````
```{r, out.width = "35%", fig.align = 'center', echo = FALSE, 
fig.cap = "This is the figure caption."}
x &lt;- rnorm(1000)
hist(x)
```
````
]


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="main_doc_files/figure-html/unnamed-chunk-29-1.png" alt="This is the figure caption." width="35%" /&gt;
&lt;p class="caption"&gt;This is the figure caption.&lt;/p&gt;
&lt;/div&gt;









---


## using `R` objects in the actual text part

.XC[
````
```{r, echo = FALSE}
data("cars")
ncars &lt;- nrow(cars)
mycor &lt;- cor(cars$speed, cars$dist)
```

The cars data set has `r ncars` observations.
And the correlation between speed and distance is `r round(mycor, 2)`.

````
]





The cars data set has 50 observations. 
And the correlation between speed and distance is 0.81.


---




## equations

.XC[
````
We can also write fancy equations like $x = \sqrt{y} + c^2$, if they 
are wrapped in dollar signs ($). But equations can also span 
multiple lines, with a 'proper' math environment:

$$
x = \sum{\frac{42 + y}{log(z)}}
$$

Fancy, isn't it?

````
]

We can also write fancy equations like `\(x = \sqrt{y} + c^2\)`, if they are wrapped in dollar signs ($). But equations can also span multiple lines, with a 'proper' math environment:

$$
x = \sum{\frac{42 + y}{log(z)}}
$$

Fancy, isn't it?

---


## tables

- are a bit trickier

- simple tables are possible with `knitr::kable()`

- more complex tables require the package `xtable`

.XC[
````
```{r, echo = FALSE}
data("airquality")
knitr::kable(head(airquality))
```

````
]


| Ozone| Solar.R| Wind| Temp| Month| Day|
|-----:|-------:|----:|----:|-----:|---:|
|    41|     190|  7.4|   67|     5|   1|
|    36|     118|  8.0|   72|     5|   2|
|    12|     149| 12.6|   74|     5|   3|
|    18|     313| 11.5|   62|     5|   4|
|    NA|      NA| 14.3|   56|     5|   5|
|    28|      NA| 14.9|   66|     5|   6|

---


## references and bibliography

- (can't be demonstrated in this particular presentation format, bummer)

- requires `bibtex` references

- bibtex files are plain text files

- probably any reference manager can import/export references in bib(la)tex style (Zotero, Mendeley, Endnote)

- in my workflow, I manage my references with Zotero, and export regularly a .bib file with all the references I ever cited at some point, which I then use for citations in R markdown documents

- check out the "Better Bib(La)TeX" plugin for Zotero (https://github.com/retorquere/zotero-better-bibtex)

- a multi-platform graphic reference manager for bib(la)tex files is JabRef (http://www.jabref.org/)

- style sheets for different journals (.csl files) can be found here: https://www.zotero.org/styles (or here: https://github.com/citation-style-language/styles)


---

## references and bibliography

- a typical bibtex entry for a journal article and book chapter (on the next slide) looks like this

- the crucial thing here is the citation key, i.e. the identifier (`forstmeier2011` in the first example)

- you need the citation key to cross-reference

.XC[
````
@article{forstmeier2011,
  title = {Cryptic Multiple Hypotheses Testing in Linear Models: 
    Overestimated Effect Sizes and the Winner's Curse},     
  volume = {65},
  doi = {10.1007/s00265-010-1038-5},
  journaltitle = {Behavioral Ecology and Sociobiology},
  date = {2011},
  pages = {47--55},
  author = {Forstmeier, Wolfgang and Schielzeth, Holger}
}
````
]

---

## references and bibliography

- here is an entry for a book chapter

.XC[
````
@incollection{garamszegi2014,
  location = {Berlin},
  title = {Multimodel-Inference in Comparative Analyses},
  booktitle = {Modern Phylogenetic Comparative Methods and 
    Their Application in Evolutionary Biology}, 
  publisher = {Springer},
  date = {2014},
  pages = {305--331},
  author = {Garamszegi, László Zsolt and Mundry, Roger},
  editor = {Garamszegi, László Zsolt}
}
````
]

---

## references and bibliography

- update the `yaml` header to point to .bib file (biblographic entries) and .csl file (formatting style)

````md
---
title: "Untitled"
author: "Christof Neumann"
date: "9/29/2021"
output: 
  html_document:
    highlight: tango
editor_options: 
  chunk_output_type: console
bibliography: data_files/refs.bib
csl: data_files/animal-behaviour.csl
---
````

---

## references and bibliography

.XC[
````
Blah blah [@forstmeier2011; @garamszegi2014].

Blah blah [see @forstmeier2011, p. 365; but see @garamszegi2014].

@forstmeier2011 say something.

````
]

--

- bibliography is inserted after the header `# references`
























---
class: inverse, center, middle

# wrapping up

---

## going further

- cross-references (to figures and tables)

--

- more table and plotting options

--

- conditional inclusion of chunks

--

- actually using `\(\LaTeX\)`

--

- caching of code chunks

--

- document formatting/layouts (e.g. thesis chapters)

--

- extended referencing (bibliographic)

--

- integrating other coding languages (Python, `stan`, `C++`, ...)

--

- put it all under version control

---

## wrapping up

- establish good practice

--

- you can't reproduce what doesn't exist

--

- think about your workflow

--

- your single most important collaborator is your future self

&lt;img src="main_doc_files/figure-html/vince-1.gif" width="60%" style="display: block; margin: auto 0 auto auto;" /&gt;


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
